<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1"><title>git signing signify</title><script>(function(b,d,e,a,g){b[a]=b[a]||[],b[a].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var f=d.getElementsByTagName(e)[0],c=d.createElement(e),h=a!="dataLayer"?"&l="+a:"";c.async=!0,c.src="https://www.googletagmanager.com/gtm.js?id="+g+h,f.parentNode.insertBefore(c,f)})(window,document,"script","dataLayer","GTM-TLVN7D6")</script><link rel=canonical href=https://seankhliao.com/blog/12020-10-31-git-signing-signify/><link rel=manifest href=/manifest.json><meta name=theme-color content="#000000"><meta name=description content="down with GPG!"><link rel=icon href=https://seankhliao.com/favicon.ico><link rel=icon href=https://seankhliao.com/static/icon.svg type=image/svg+xml sizes=any><link rel=apple-touch-icon href=https://seankhliao.com/static/icon-192.png><style>*{box-sizing:border-box}:root{background:#000;color:#eceff1;font:18px inconsolata,monospace}@font-face{font-family:inconsolata;font-style:normal;font-weight:400;font-display:swap;src:local("Inconsolata"),local("Inconsolata-Regular"),url(https://seankhliao.com/static/inconsolata-var.woff2)format("woff2-variations"),url(https://seankhliao.com/static/inconsolata-400.woff2)format("woff2")}@font-face{font-family:inconsolata;font-style:normal;font-weight:700;font-display:swap;src:local("Inconsolata Bold"),local("Inconsolata-Bold"),url(https://seankhliao.com/static/inconsolata-var.woff2)format("woff2-variations"),url(https://seankhliao.com/static/inconsolata-700.woff2)format("woff2")}@font-face{font-family:lora;font-style:normal;font-weight:400;font-display:swap;src:local("Lora"),local("Lora-Regular"),url(https://seankhliao.com/static/lora-var.woff2)format("woff2-variations"),url(https://seankhliao.com/static/lora-400.woff2)format("woff2")}@font-face{font-family:lora;font-style:normal;font-weight:700;font-display:swap;src:local("Lora Bold"),local("Lora-Bold"),url(https://seankhliao.com/static/lora-var.woff2)format("woff2-variations"),url(https://seankhliao.com/static/lora-700.woff2)format("woff2")}body{grid:20vh 60vh/1fr repeat(3,minmax(90px,280px))1fr;display:grid;gap:0 1em;margin:0;padding:1vmin;background:#000;color:#eceff1;font:18px inconsolata,monospace}body>*{grid-column:2/span 3}h1{font-size:4.5vmin;grid-area:1/4/span 1/span 2;margin:0;place-self:end}h2{color:#999;font-size:3.5vmin;grid-area:2/4/span 1/span 2;place-self:start end;text-align:right}hgroup{font:700 5vmin lora,serif;grid-area:1/1/span 2/span 2;margin:0;place-self:end start}hgroup a{display:grid;grid:repeat(2,10vmin)/repeat(8,10vmin);place-content:center center}hgroup *:nth-child(n+5){grid-row:2/span 1}footer,iframe,pre,table,picture{grid-column:1/span 5;margin:.25em -1vmin 2em}picture img{width:100%;margin:auto}h3,h4,picture{margin:25vh 0 .25em}h5,h6{margin:1.5em 0 .25em}h3{font-size:2.441em}h4{font-size:1.953em}h5{font-size:1.563em}h6{font-size:1.25em}p{line-height:1.5;margin:0 0 1em}footer{margin:10vh auto 3vh}a,a:visited{color:inherit;font-weight:700;text-decoration:underline 1px #707070}a:hover{color:#a06be0;transition:color .16s;text-decoration:underline 1px #a06be0}h1 a,h1 a:hover,h1 a:visited,hgroup a,hgroup a:hover,hgroup a:visited{color:inherit;text-decoration:none}ul{list-style:none;margin:0}ul>*{margin:.5em;line-height:1.5em}ul>li:before{content:"Â»";margin:0 1ch 0 -3ch;position:absolute}ol>*{line-height:1.75em}blockquote{margin:1em;padding:.25em 1em;border-left:1ch solid #999}code{background:#303030;font:1em inconsolata,monospace;padding:.1em}pre{background:#303030;overflow-x:scroll;padding:1em}pre::-webkit-scrollbar{display:none}pre code{padding:0}iframe{margin:auto}em{color:#a06be0;background-color:unset;font-style:normal;font-weight:700}time{color:#999}table{border-collapse:collapse;border-style:hidden}th,td{padding:.4em;text-align:left}th{font-weight:700;border-bottom:.2em solid #999}tr:nth-child(5n) td{border-bottom:.1em solid #999}tbody tr:hover{background:#404040}noscript iframe{height:0;width:0;display:none;visibility:hidden}</style><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TLVN7D6" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><h1><a href=/blog/>b<em>log</em></a></h1><h2>12020-10-31</h2><hgroup><a href=/><span>S</span><span>E</span><span>A</span><span>N</span>
<em>K</em><em>.</em><em>H</em><em>.</em>
<span>L</span><span>I</span><span>A</span><span>O</span></a></hgroup><h3 id=-git--signing><em>git</em> signing</h3><p>Ah, <em>git</em>, well known for its not very friendly ux,
integrates with another piece of software
that is also often derided for having bad ux,
namely <em>gpg</em>.<p>So you can sign tags, sign commits, and verify them.
But who wants to use GPG?
Why not use something else like minisign or signify
or SSH keys?<p>Well you can, sort of.
Git right now hardcodes some GPG stuff so you need to work around it.
Specifically it expects an out of band communication channel <code>--status-fd=X</code>
for getting notified of
<code>[GNUPG:] SIG_CREATED</code>, <code>[GNUPG:] GOODSIG</code>, <code>[GNUPG:] BADSIG</code>
and while you can return any text as the signature for the signing operations,
the verifying operations will look for a <code>-----BEGIN/END PGP SIGNATURE-----</code>
block that it can extract before the verifying program is called.<p>Note: if you do this, it is unlikely that anyone else will be able to
parse/verify your signatures and forget about it working in Github/etc.<p>So what you can do is smuggle your signature in the block
and write to the status fd as appropriate.
This is an ugly hack because you will need those fake PGP lines,
but you can put whatever inside.
This is demonstrated in a
<a href=https://leahneukirchen.org/dotfiles/bin/git-signify>script by Leah Neukirchen</a> replicated below.<pre><code class=language-sh>#!/bin/sh
# git-signify [GIT COMMAND] - use git with signify(1)
#
# First, you need to set the signing key for the repo, e.g.
#   git config --local user.signingKey ~/.signify/cwm
# This will use cwm.sec and cwm.pub.
#
# Then you can use
#   gpg signify commit -S
#   gpg signify verify-commit
#
#   gpg signify tag -s
#   gpg signify verify-tag
#
# You also can set this script as &quot;gpg.program&quot; to use signify
# automatically.
#
# To the extent possible under law, Leah Neukirchen has waived
# all copyright and related or neighboring rights to this work.
# http://creativecommons.org/publicdomain/zero/1.0/

getkey() {
    key=$(git config user.signingKey)
    if [ -z &quot;$key&quot; ]; then
        echo &quot;git-signify: no user.signingKey defined!&quot; 1&gt;&amp;2
        exit 7
    fi
}

while :; do
case &quot;$1&quot; in
-bsau)
    getkey
    echo &quot;-----BEGIN PGP SIGNATURE----- (really git-signify)&quot;
    {
        signify -S -s &quot;$key.sec&quot; -m - -x -
        if [ $? -eq 0 ] &amp;&amp; [ -n &quot;$statusfd&quot; ]; then
            printf '\n[GNUPG:] SIG_CREATED ' &gt;/dev/fd/$statusfd
        fi
    } | sed &quot;s/: .*/: verify with git-signify and ${key##*/}.pub/&quot;
    echo &quot;-----END PGP SIGNATURE-----&quot;
    exit 0
    ;;
--verify)
    getkey
    sed -i '/-----.* PGP SIGNATURE-----/d' &quot;$2&quot;
    if signify -V -p &quot;$key.pub&quot; -m - -x &quot;$2&quot; 1&gt;&amp;2; then
        echo &quot;[GNUPG:] GOODSIG &quot;
        exit 0
    else
        r=$?
        echo &quot;[GNUPG:] BADSIG &quot;
        exit $r
    fi
    ;;
--status-fd=*)
    statusfd=${1#--status-fd=}
    shift
    ;;
--*)
    # ignore all other arguments
    shift
    ;;
*)
    exec git -c &quot;gpg.program=$0&quot; &quot;$@&quot;
    ;;
esac
done
</code></pre><footer><a href=https://seankhliao.com/>home</a>
|
<a href=https://seankhliao.com/blog/>blog</a>
|
<a href=https://github.com/seankhliao>github</a></footer>