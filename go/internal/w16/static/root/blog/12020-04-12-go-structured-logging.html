<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1"><title>go structured logging</title><script>(function(b,d,e,a,g){b[a]=b[a]||[],b[a].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var f=d.getElementsByTagName(e)[0],c=d.createElement(e),h=a!="dataLayer"?"&l="+a:"";c.async=!0,c.src="https://www.googletagmanager.com/gtm.js?id="+g+h,f.parentNode.insertBefore(c,f)})(window,document,"script","dataLayer","GTM-TLVN7D6")</script><link rel=canonical href=https://seankhliao.com/blog/12020-04-12-go-structured-logging/><link rel=manifest href=/manifest.json><meta name=theme-color content="#000000"><meta name=description content="comparing structured logging libraries in go"><link rel=icon href=https://seankhliao.com/favicon.ico><link rel=icon href=https://seankhliao.com/static/icon.svg type=image/svg+xml sizes=any><link rel=apple-touch-icon href=https://seankhliao.com/static/icon-192.png><style>*{box-sizing:border-box}:root{background:#000;color:#eceff1;font:18px inconsolata,monospace}@font-face{font-family:inconsolata;font-style:normal;font-weight:400;font-display:swap;src:local("Inconsolata"),local("Inconsolata-Regular"),url(https://seankhliao.com/static/inconsolata-var.woff2)format("woff2-variations"),url(https://seankhliao.com/static/inconsolata-400.woff2)format("woff2")}@font-face{font-family:inconsolata;font-style:normal;font-weight:700;font-display:swap;src:local("Inconsolata Bold"),local("Inconsolata-Bold"),url(https://seankhliao.com/static/inconsolata-var.woff2)format("woff2-variations"),url(https://seankhliao.com/static/inconsolata-700.woff2)format("woff2")}@font-face{font-family:lora;font-style:normal;font-weight:400;font-display:swap;src:local("Lora"),local("Lora-Regular"),url(https://seankhliao.com/static/lora-var.woff2)format("woff2-variations"),url(https://seankhliao.com/static/lora-400.woff2)format("woff2")}@font-face{font-family:lora;font-style:normal;font-weight:700;font-display:swap;src:local("Lora Bold"),local("Lora-Bold"),url(https://seankhliao.com/static/lora-var.woff2)format("woff2-variations"),url(https://seankhliao.com/static/lora-700.woff2)format("woff2")}body{grid:20vh 60vh/1fr repeat(3,minmax(90px,280px))1fr;display:grid;gap:0 1em;margin:0;padding:1vmin;background:#000;color:#eceff1;font:18px inconsolata,monospace}body>*{grid-column:2/span 3}h1{font-size:4.5vmin;grid-area:1/4/span 1/span 2;margin:0;place-self:end}h2{color:#999;font-size:3.5vmin;grid-area:2/4/span 1/span 2;place-self:start end;text-align:right}hgroup{font:700 5vmin lora,serif;grid-area:1/1/span 2/span 2;margin:0;place-self:end start}hgroup a{display:grid;grid:repeat(2,10vmin)/repeat(8,10vmin);place-content:center center}hgroup *:nth-child(n+5){grid-row:2/span 1}footer,iframe,pre,table,picture{grid-column:1/span 5;margin:.25em -1vmin 2em}picture img{width:100%;margin:auto}h3,h4,picture{margin:25vh 0 .25em}h5,h6{margin:1.5em 0 .25em}h3{font-size:2.441em}h4{font-size:1.953em}h5{font-size:1.563em}h6{font-size:1.25em}p{line-height:1.5;margin:0 0 1em}footer{margin:10vh auto 3vh}a,a:visited{color:inherit;font-weight:700;text-decoration:underline 1px #707070}a:hover{color:#a06be0;transition:color .16s;text-decoration:underline 1px #a06be0}h1 a,h1 a:hover,h1 a:visited,hgroup a,hgroup a:hover,hgroup a:visited{color:inherit;text-decoration:none}ul{list-style:none;margin:0}ul>*{margin:.5em;line-height:1.5em}ul>li:before{content:"»";margin:0 1ch 0 -3ch;position:absolute}ol>*{line-height:1.75em}blockquote{margin:1em;padding:.25em 1em;border-left:1ch solid #999}code{background:#303030;font:1em inconsolata,monospace;padding:.1em}pre{background:#303030;overflow-x:scroll;padding:1em}pre::-webkit-scrollbar{display:none}pre code{padding:0}iframe{margin:auto}em{color:#a06be0;background-color:unset;font-style:normal;font-weight:700}time{color:#999}table{border-collapse:collapse;border-style:hidden}th,td{padding:.4em;text-align:left}th{font-weight:700;border-bottom:.2em solid #999}tr:nth-child(5n) td{border-bottom:.1em solid #999}tbody tr:hover{background:#404040}noscript iframe{height:0;width:0;display:none;visibility:hidden}</style><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TLVN7D6" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><h1><a href=/blog/>b<em>log</em></a></h1><h2>12020-04-12</h2><hgroup><a href=/><span>S</span><span>E</span><span>A</span><span>N</span>
<em>K</em><em>.</em><em>H</em><em>.</em>
<span>L</span><span>I</span><span>A</span><span>O</span></a></hgroup><h3 id=-structured--logging><em>structured</em> logging</h3><p>who wants to read a mess of words anyways<h4 id=tldr>tldr</h4><p>use <code>github.com/rs/zerolog</code> because I like the api and the output format<h4 id=about>about</h4><h5 id=criteria>criteria</h5><ul><li>structured/levelled<li>json output<li>logfmt/txt output</ul><h4 id=benchmark>Benchmark</h4><p>code <a href=https://gist.github.com/seankhliao/259ab478721d84ad6f2f5935f7fe052f>gist</a><pre><code class=language-txt>» go test -bench . -benchmem
goos: linux
goarch: amd64
pkg: t
BenchmarkApexTxt-4                     305184              3541 ns/op            1228 B/op              20 allocs/op
BenchmarkApexJSON-4                    275408              4287 ns/op            1568 B/op              23 allocs/op
BenchmarkGokitTxt-4                   1000000              1154 ns/op             468 B/op               5 allocs/op
BenchmarkGokitJSON-4                   319072              3619 ns/op            1232 B/op              22 allocs/op
BenchmarkLog15JSON-4                   172742              7028 ns/op            2208 B/op              33 allocs/op
BenchmarkLog15Txt-4                    324510              3578 ns/op            1376 B/op              20 allocs/op
BenchmarkLogrusJSON-4                  203190              5791 ns/op            1974 B/op              35 allocs/op
BenchmarkLogrusTxt-4                   260695              4694 ns/op            1056 B/op              23 allocs/op
BenchmarkZapJSON-4                    1000000              1057 ns/op             256 B/op               1 allocs/op
BenchmarkZapTxt-4                      724332              1560 ns/op             368 B/op               5 allocs/op
BenchmarkZapSugarJSON-4                750585              1370 ns/op             512 B/op               1 allocs/op
BenchmarkZapSugarTxt-4                 605372              1855 ns/op             624 B/op               5 allocs/op
BenchmarkZerologJSON-4                2005058               588 ns/op               0 B/op               0 allocs/op
BenchmarkZerologTxt-4                   98937             11678 ns/op            2873 B/op              93 allocs/op
BenchmarkKlogInterface-4               736012              1631 ns/op             216 B/op               2 allocs/op
BenchmarkKlogFormat-4                  797425              1501 ns/op             216 B/op               2 allocs/op
BenchmarkStdlibInterface-4            1978610               607 ns/op              48 B/op               1 allocs/op
BenchmarkStdlibFormat-4               2119566               565 ns/op              48 B/op               1 allocs/op
PASS
ok          t        23.216s
</code></pre><h4 id=loggers>loggers</h4><ul><li><code>github.com/apex/log</code><li><code>github.com/go-kit/kit/log</code><li><code>github.com/inconshreveable/log15</code><li><code>github.com/rs/zerolog</code><li><code>github.com/sirupsen/logrus</code><li><code>go.uber.org/zap</code></ul><p>not structured:<ul><li><code>k8s.io/klog</code> (fork of glog)<li><code>log</code> (stdlib)</ul><h5 id=apex>apex</h5><p>code:<pre><code class=language-go>import (
        apex &quot;github.com/apex/log&quot;
        &quot;github.com/apex/log/handlers/json&quot;
        &quot;github.com/apex/log/handlers/logfmt&quot;
)

func Apex() {
        fmt.Println(&quot;\nApex&quot;)
        l := &amp;apex.Logger{Handler: json.New(os.Stdout), Level: apex.InfoLevel}
        l.WithFields(apex.Fields{&quot;bool&quot;: true, &quot;int&quot;: 1, &quot;str&quot;: &quot;s&quot;, &quot;err&quot;: err}).Info(&quot;apex json&quot;)

        l = &amp;apex.Logger{Handler: logfmt.New(os.Stdout), Level: apex.InfoLevel}
        l.WithFields(apex.Fields{&quot;bool&quot;: true, &quot;int&quot;: 1, &quot;str&quot;: &quot;s&quot;, &quot;err&quot;: err}).Info(&quot;apex txt&quot;)
}
</code></pre><p>output:<pre><code class=language-txt>Apex
{&quot;fields&quot;:{&quot;bool&quot;:true,&quot;err&quot;:{},&quot;int&quot;:1,&quot;str&quot;:&quot;s&quot;},&quot;level&quot;:&quot;info&quot;,&quot;timestamp&quot;:&quot;2020-04-12T22:58:32.105258571+02:00&quot;,&quot;message&quot;:&quot;apex json&quot;}
timestamp=2020-04-12T22:58:32.105372627+02:00 level=info message=&quot;apex txt&quot; bool=true err=&quot;an err&quot; int=1 str=s
</code></pre><h5 id=gokit>Gokit</h5><p>code:<pre><code class=language-go>import (
        kitlog &quot;github.com/go-kit/kit/log&quot;
)

func Gokit() {
        fmt.Println(&quot;\nGokit&quot;)
        l := kitlog.NewJSONLogger(os.Stdout)
        l.Log(&quot;gokit json&quot;, &quot;bool&quot;, true, &quot;int&quot;, 1, &quot;str&quot;, &quot;s&quot;, &quot;err&quot;, err)

        l = kitlog.NewLogfmtLogger(os.Stdout)
        l.Log(&quot;gokit txt&quot;, &quot;bool&quot;, true, &quot;int&quot;, 1, &quot;str&quot;, &quot;s&quot;, &quot;err&quot;, err)
}
</code></pre><p>output:<pre><code class=language-txt>Gokit
{&quot;1&quot;:&quot;str&quot;,&quot;an err&quot;:&quot;(MISSING)&quot;,&quot;gokit json&quot;:&quot;bool&quot;,&quot;s&quot;:&quot;err&quot;,&quot;true&quot;:&quot;int&quot;}
gokittxt=bool true=int 1=str s=err
</code></pre><h5 id=log15>Log15</h5><p>code:<pre><code class=language-go>import (
        &quot;github.com/inconshreveable/log15&quot;
)

func Log15() {
        fmt.Println(&quot;\nLog15&quot;)
        l := log15.New()
        l.SetHandler(log15.StreamHandler(os.Stdout, log15.JsonFormat()))
        l.Info(&quot;log15 json&quot;, &quot;bool&quot;, true, &quot;int&quot;, 1, &quot;str&quot;, &quot;s&quot;, &quot;err&quot;, err)

        l = log15.New()
        l.SetHandler(log15.StreamHandler(os.Stdout, log15.LogfmtFormat()))
        l.Info(&quot;log15 json&quot;, &quot;bool&quot;, true, &quot;int&quot;, 1, &quot;str&quot;, &quot;s&quot;, &quot;err&quot;, err)
}
</code></pre><p>output:<pre><code class=language-txt>Log15
{&quot;bool&quot;:true,&quot;err&quot;:&quot;an err&quot;,&quot;int&quot;:1,&quot;lvl&quot;:&quot;info&quot;,&quot;msg&quot;:&quot;log15 json&quot;,&quot;str&quot;:&quot;s&quot;,&quot;t&quot;:&quot;2020-04-12T22:58:32.105473094+02:00&quot;}
t=2020-04-12T22:58:32+0200 lvl=info msg=&quot;log15 json&quot; bool=true int=1 str=s err=&quot;an err&quot;
</code></pre><h5 id=logrus>Logrus</h5><p>code:<pre><code class=language-go>import (
        &quot;github.com/sirupsen/logrus&quot;
)

func Logrus() {
        fmt.Println(&quot;\nLogrus&quot;)
        l := &amp;logrus.Logger{Out: os.Stdout, Formatter: &amp;logrus.JSONFormatter{}, Level: logrus.InfoLevel}
        l.WithFields(logrus.Fields{&quot;bool&quot;: true, &quot;int&quot;: 1, &quot;str&quot;: &quot;s&quot;, &quot;err&quot;: err}).Info(&quot;logrus json&quot;)

        l = &amp;logrus.Logger{Out: os.Stdout, Formatter: &amp;logrus.TextFormatter{}, Level: logrus.InfoLevel}
        l.WithFields(logrus.Fields{&quot;bool&quot;: true, &quot;int&quot;: 1, &quot;str&quot;: &quot;s&quot;, &quot;err&quot;: err}).Info(&quot;logrus txt&quot;)
}
</code></pre><p>output:<pre><code class=language-txt>Logrus
{&quot;bool&quot;:true,&quot;err&quot;:&quot;an err&quot;,&quot;int&quot;:1,&quot;level&quot;:&quot;info&quot;,&quot;msg&quot;:&quot;logrus json&quot;,&quot;str&quot;:&quot;s&quot;,&quot;time&quot;:&quot;2020-04-12T22:58:32+02:00&quot;}
INFO[0000] logrus txt                                    bool=true err=&quot;an err&quot; int=1 str=s
</code></pre><h5 id=zap>Zap</h5><p>code:<pre><code class=language-go>import(
        &quot;go.uber.org/zap&quot;
)

func Zap() {
        fmt.Println(&quot;\nZap&quot;)
        l, _ := zap.NewProduction()
        l.Info(&quot;zap json&quot;, zap.Bool(&quot;bool&quot;, true), zap.Int(&quot;int&quot;, 1), zap.String(&quot;str&quot;, &quot;s&quot;), zap.Error(err))

        l, _ = zap.NewDevelopment()
        l.Info(&quot;zap txt&quot;, zap.Bool(&quot;bool&quot;, true), zap.Int(&quot;int&quot;, 1), zap.String(&quot;str&quot;, &quot;s&quot;), zap.Error(err))
}
</code></pre><p>output:<pre><code class=language-txt>Zap
{&quot;level&quot;:&quot;info&quot;,&quot;ts&quot;:1586725112.1056206,&quot;caller&quot;:&quot;testrepo-82/main.go:78&quot;,&quot;msg&quot;:&quot;zap json&quot;,&quot;bool&quot;:true,&quot;int&quot;:1,&quot;str&quot;:&quot;s&quot;,&quot;error&quot;:&quot;an err&quot;}
2020-04-12T22:58:32.105+0200        INFO        testrepo-82/main.go:81        zap txt        {&quot;bool&quot;: true, &quot;int&quot;: 1, &quot;str&quot;: &quot;s&quot;, &quot;error&quot;: &quot;an err&quot;}
</code></pre><h5 id=zap-sugared>Zap Sugared</h5><p>code:<pre><code class=language-go>import(
        &quot;go.uber.org/zap&quot;
)

func ZapSugar() {
        fmt.Println(&quot;\nZap Sugar&quot;)
        l, _ := zap.NewProduction()
        l.Sugar().Infow(&quot;zap sugar json&quot;, &quot;bool&quot;, true, &quot;int&quot;, 1, &quot;str&quot;, &quot;s&quot;, &quot;err&quot;, err)

        l, _ = zap.NewDevelopment()
        l.Sugar().Infow(&quot;zap sugar txt&quot;, &quot;bool&quot;, true, &quot;int&quot;, 1, &quot;str&quot;, &quot;s&quot;, &quot;err&quot;, err)
}
</code></pre><p>output:<pre><code class=language-txt>Zap Sugar
{&quot;level&quot;:&quot;info&quot;,&quot;ts&quot;:1586725112.1056879,&quot;caller&quot;:&quot;testrepo-82/main.go:87&quot;,&quot;msg&quot;:&quot;zap sugar json&quot;,&quot;bool&quot;:true,&quot;int&quot;:1,&quot;str&quot;:&quot;s&quot;,&quot;err&quot;:&quot;an err&quot;}
2020-04-12T22:58:32.105+0200        INFO        testrepo-82/main.go:90        zap sugar txt        {&quot;bool&quot;: true, &quot;int&quot;: 1, &quot;str&quot;: &quot;s&quot;, &quot;err&quot;: &quot;an err&quot;}
</code></pre><h5 id=zerolog>Zerolog</h5><p>code:<pre><code class=language-go>import(
        &quot;github.com/rs/zerolog&quot;
)

func Zerolog() {
        fmt.Println(&quot;\nZerolog&quot;)
        l := zerolog.New(os.Stdout).With().Timestamp().Logger()
        l.Info().Bool(&quot;bool&quot;, true).Int(&quot;int&quot;, 0).Str(&quot;str&quot;, &quot;s&quot;).Err(err).Msg(&quot;zerolog json&quot;)

        l = zerolog.New(zerolog.ConsoleWriter{Out: os.Stdout, NoColor: true, TimeFormat: time.RFC3339}).With().Timestamp().Logger()
        l.Info().Bool(&quot;bool&quot;, true).Int(&quot;int&quot;, 1).Str(&quot;str&quot;, &quot;s&quot;).Err(err).Msg(&quot;zerolog txt&quot;)
}
</code></pre><p>output:<pre><code class=language-txt>Zerolog
{&quot;level&quot;:&quot;info&quot;,&quot;bool&quot;:true,&quot;int&quot;:0,&quot;str&quot;:&quot;s&quot;,&quot;error&quot;:&quot;an err&quot;,&quot;time&quot;:&quot;2020-04-12T22:58:32+02:00&quot;,&quot;message&quot;:&quot;zerolog json&quot;}
2020-04-12T22:58:32+02:00 INF zerolog txt error=&quot;an err&quot; bool=true int=1 str=s
</code></pre><h5 id=klog>Klog</h5><p>code:<pre><code class=language-go>import(
        &quot;k8s.io/klog&quot;
)

func Klog() {
        fmt.Println(&quot;\nKlog&quot;)
        klog.Info(&quot;klog&quot;, &quot;bool&quot;, true, &quot;int&quot;, 1, &quot;str&quot;, &quot;s&quot;, &quot;err&quot;, err)
        klog.Infof(&quot;klog bool=%v int=%v str=%v err=%v\n&quot;, true, 1, &quot;s&quot;, err)
}
</code></pre><pre><code class=language-txt>Klog
I0412 22:58:32.105824  258002 main.go:104] klogbooltrueint1strserran err
I0412 22:58:32.105840  258002 main.go:105] klog bool=true int=1 str=s err=an err
</code></pre><h5 id=log>Log</h5><p>code:<pre><code class=language-go>import(
        &quot;log&quot;
)

func Std() {
        fmt.Println(&quot;\nstdlib&quot;)
        log.Println(&quot;stdlib&quot;, &quot;bool&quot;, true, &quot;int&quot;, 1, &quot;str&quot;, &quot;s&quot;, &quot;err&quot;, err)
        log.Printf(&quot;klog bool=%v int=%v str=%v err=%v\n&quot;, true, 1, &quot;s&quot;, err)
}
</code></pre><p>output:<pre><code class=language-txt>stdlib
2020/04/12 23:01:38 stdlib bool true int 1 str s err an err
2020/04/12 23:01:38 stdlib bool=true int=1 str=s err=an err
</code></pre><footer><a href=https://seankhliao.com/>home</a>
|
<a href=https://seankhliao.com/blog/>blog</a>
|
<a href=https://github.com/seankhliao>github</a></footer>