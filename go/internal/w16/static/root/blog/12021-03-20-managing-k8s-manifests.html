<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1"><title>managing k8s manifests</title><script>(function(b,d,e,a,g){b[a]=b[a]||[],b[a].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var f=d.getElementsByTagName(e)[0],c=d.createElement(e),h=a!="dataLayer"?"&l="+a:"";c.async=!0,c.src="https://www.googletagmanager.com/gtm.js?id="+g+h,f.parentNode.insertBefore(c,f)})(window,document,"script","dataLayer","GTM-TLVN7D6")</script><link rel=canonical href=https://seankhliao.com/blog/12021-03-20-managing-k8s-manifests/><link rel=manifest href=/manifest.json><meta name=theme-color content="#000000"><meta name=description content="too much yaml"><link rel=icon href=https://seankhliao.com/favicon.ico><link rel=icon href=https://seankhliao.com/static/icon.svg type=image/svg+xml sizes=any><link rel=apple-touch-icon href=https://seankhliao.com/static/icon-192.png><style>*{box-sizing:border-box}:root{background:#000;color:#eceff1;font:18px inconsolata,monospace}@font-face{font-family:inconsolata;font-style:normal;font-weight:400;font-display:swap;src:local("Inconsolata"),local("Inconsolata-Regular"),url(https://seankhliao.com/static/inconsolata-var.woff2)format("woff2-variations"),url(https://seankhliao.com/static/inconsolata-400.woff2)format("woff2")}@font-face{font-family:inconsolata;font-style:normal;font-weight:700;font-display:swap;src:local("Inconsolata Bold"),local("Inconsolata-Bold"),url(https://seankhliao.com/static/inconsolata-var.woff2)format("woff2-variations"),url(https://seankhliao.com/static/inconsolata-700.woff2)format("woff2")}@font-face{font-family:lora;font-style:normal;font-weight:400;font-display:swap;src:local("Lora"),local("Lora-Regular"),url(https://seankhliao.com/static/lora-var.woff2)format("woff2-variations"),url(https://seankhliao.com/static/lora-400.woff2)format("woff2")}@font-face{font-family:lora;font-style:normal;font-weight:700;font-display:swap;src:local("Lora Bold"),local("Lora-Bold"),url(https://seankhliao.com/static/lora-var.woff2)format("woff2-variations"),url(https://seankhliao.com/static/lora-700.woff2)format("woff2")}body{grid:20vh 60vh/1fr repeat(3,minmax(90px,280px))1fr;display:grid;gap:0 1em;margin:0;padding:1vmin;background:#000;color:#eceff1;font:18px inconsolata,monospace}body>*{grid-column:2/span 3}h1{font-size:4.5vmin;grid-area:1/4/span 1/span 2;margin:0;place-self:end}h2{color:#999;font-size:3.5vmin;grid-area:2/4/span 1/span 2;place-self:start end;text-align:right}hgroup{font:700 5vmin lora,serif;grid-area:1/1/span 2/span 2;margin:0;place-self:end start}hgroup a{display:grid;grid:repeat(2,10vmin)/repeat(8,10vmin);place-content:center center}hgroup *:nth-child(n+5){grid-row:2/span 1}footer,iframe,pre,table,picture{grid-column:1/span 5;margin:.25em -1vmin 2em}picture img{width:100%;margin:auto}h3,h4,picture{margin:25vh 0 .25em}h5,h6{margin:1.5em 0 .25em}h3{font-size:2.441em}h4{font-size:1.953em}h5{font-size:1.563em}h6{font-size:1.25em}p{line-height:1.5;margin:0 0 1em}footer{margin:10vh auto 3vh}a,a:visited{color:inherit;font-weight:700;text-decoration:underline 1px #707070}a:hover{color:#a06be0;transition:color .16s;text-decoration:underline 1px #a06be0}h1 a,h1 a:hover,h1 a:visited,hgroup a,hgroup a:hover,hgroup a:visited{color:inherit;text-decoration:none}ul{list-style:none;margin:0}ul>*{margin:.5em;line-height:1.5em}ul>li:before{content:"Â»";margin:0 1ch 0 -3ch;position:absolute}ol>*{line-height:1.75em}blockquote{margin:1em;padding:.25em 1em;border-left:1ch solid #999}code{background:#303030;font:1em inconsolata,monospace;padding:.1em}pre{background:#303030;overflow-x:scroll;padding:1em}pre::-webkit-scrollbar{display:none}pre code{padding:0}iframe{margin:auto}em{color:#a06be0;background-color:unset;font-style:normal;font-weight:700}time{color:#999}table{border-collapse:collapse;border-style:hidden}th,td{padding:.4em;text-align:left}th{font-weight:700;border-bottom:.2em solid #999}tr:nth-child(5n) td{border-bottom:.1em solid #999}tbody tr:hover{background:#404040}noscript iframe{height:0;width:0;display:none;visibility:hidden}</style><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TLVN7D6" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><h1><a href=/blog/>b<em>log</em></a></h1><h2>12021-03-20</h2><hgroup><a href=/><span>S</span><span>E</span><span>A</span><span>N</span>
<em>K</em><em>.</em><em>H</em><em>.</em>
<span>L</span><span>I</span><span>A</span><span>O</span></a></hgroup><h3 id=-k8s--manifests><em>k8s</em> manifests</h3><p>Kubernetes manifests are great, defining a common, declarative,
API-first approach to managing resources.
Just too bad that the canonical format is
<a href=https://yaml.org/>YAML</a> with all its oddities, especially around types.
And the fact that there isn't much to help you deal with repitition
of same or similar blocks.<p>So what other options do we have?<h4 id=-helm-><em>helm</em></h4><p>Ah, <a href=https://helm.sh/>Helm</a>, CNCF Graduated,
and the closest thing to a standard package manager for kubernetes.
What you get is using <a href=https://pkg.go.dev/text/template>Go text/template</a>
to generate YAML (not even structured data),
feeding in variables through another YAML file,
with all the typing problems that comes with it.
It sort-of helps with duplication in a single chart,
or if you have the stomach for it,
a single chart that you can cram all your microservices into.
It's a (not very smart) templating engine with a deployment tool on top,
and your customization points are limited to what the chart authors came up with,
and if you use upstream charts, they're all of varying quality.
you have to deal with varing levels of quality from upstream charts.<h4 id=-kustomize-><em>kustomize</em></h4><p>A step up from raw kubernetes manifests,
you get some common functionality, like label and annotations for everything,
in a short form with patches and transformers for a fully customizable output.
It does require more sprawl in directory and file setups but it can manage your entire cluster.
You're still writing YAML though... and the correct docs for it are a bit hard to find (hint: last one):<ul><li><a href=https://kustomize.io/>kustomize.io</a><li><a href=https://kubernetes-sigs.github.io/kustomize/>kubernetes-sigs.github.io/kustomize</a><li><a href=https://kubectl.docs.kubernetes.io/references/kustomize/>kubectl.docs.kubernetes.io</a></ul><h4 id=terraform--kubernetes--provider>terraform <em>kubernetes</em> provider</h4><p><a href=https://registry.terraform.io/providers/hashicorp/kubernetes/latest>Kubernetes provider</a>:
you write the same manifest, but in HCL / terraform.
Good: less YAML to worry about. Bad: HCL is more verbose in lines-of-code (screen real estate),
blocks don't have a good story for reuse in variables, and you're limited to the resource versions they've defined.<h4 id=terraform-kubernetes--alpha--provider>terraform kubernetes <em>alpha</em> provider</h4><p><a href=https://registry.terraform.io/providers/hashicorp/kubernetes-alpha/latest>Kubernetes Alpha provider</a>:
write any k8s resource in HCL / terraform,
which sort of makes you question why, other than you really hate YAML.<h4 id=grafana--tanka->grafana <em>tanka</em></h4><p><a href=https://tanka.dev/>Tanka</a>, write your manifests in <a href=https://jsonnet.org>json(net)</a>, it's not as bad as it sounds,
with some functions and templating blocks and overrides,
but it is a bit exotic?
If you're fully into the Grafana ecosystem,
jsonnet is probably really worth it (also for Grafana dashboards).<h4 id=-cue-><em>cue</em></h4><p><a href=https://cuelang.org/>CUE</a>, more a language than a fully featured tool,
the core idea seems to be having a schema you can validate / generate against.
The <a href=https://cuelang.org/docs/usecases/configuration/#comparisons>comparison sections</a> in its usecases
go into more detail,
but in general, probably not as good for managing config sprawl.<footer><a href=https://seankhliao.com/>home</a>
|
<a href=https://seankhliao.com/blog/>blog</a>
|
<a href=https://github.com/seankhliao>github</a></footer>